SUMEI   RE1 RE0 1
SUMEI   RE2 RE0 17
SLE     RE1 RE1 RE2
SUMEI   RE1 RE1 28
SUMEI   RE2 RE0 1


horizontal
SUMEI   RE5 RE0 400     # Red channel start address
SUMEI   RE7 RE0 200     # Loop limit    
SUMEI   RE9 RE0 0       # k start value
SUMEI   RE10 RE0 0      # j start value
SUMEI   RE11 RE0 0      # i start value



hor_iterate_colums
SEQ     RE10 RE7 hor_end_iterate_colums
SUMEE   RE15 RE3 RE10   # RE15 = mask_start_address + j
SUMEE   RE6 RE1 RE10    # store_address = store_start_address + j
SUMEE   RE8 RE5 RE10    # row_start_address = row_start_address + j

CRGV    RV1 RE15        # Load mask section


hor_iterate_rows
SEQ     RE11 RE7 hor_end_iterate_rows      
CRGV    RV2 RE8         # Load row section

SAL  alpha_composition

hor_continue_iterate_rows
SUMEI   RE11 RE11 1     # Increment i counter by 1
SUMEI   RE8 RE8 200     # Increment address by 200 to read the next row
ALMV    RE6 RV3         # Store result section
SUMEI   RE6 RE6 200     # Increment store counter by 200

SAL hor_iterate_rows

hor_end_iterate_rows
SUMEI   RE10 RE10 20    # j = j + 20
NOP
NOP
SAL     hor_iterate_colums


hor_end_iterate_colums

SAL end_horizontal






SUMEI   RE4 RE0 187
SUMEV   RV1 RV0 RE4
SUMEI   RE4 RE0 75
SUMEV   RV2 RV0 RE4



alpha_composition
SUMEI   RE12 RE0 1
SUMEI   RE13 RE0 0
SUMEI   RE14 RE0 1
SUMEI   RE15 RE0 2

SEQ     RE2 RE13 alpha_zero
SEQ     RE2 RE14 alpha_one
SEQ     RE2 RE15 alpha_two
SAL     alpha_three

alpha_zero
SUMVV   RV3 RV0 RV2
NOP
NOP
SAL     end_alpha_composition

alpha_three
SUMVV   RV3 RV0 RV1
NOP
NOP
SAL     end_alpha_composition

alpha_one
SRV     RV4 RV1 RE12
NOP
NOP
SRV     RV4 RV4 RE12
SRV     RV7 RV2 RE12
NOP
NOP
SRV     RV6 RV7 RE12
NOP
NOP
SUMVV   RV3 RV6 RV7
NOP
NOP
SUMVV   RV3 RV4 RV3
NOP
NOP
SAL     end_alpha_composition  

alpha_two
SRV     RV7 RV1 RE12
NOP
NOP
SRV     RV6 RV7 RE12
NOP
NOP
SUMVV   RV6 RV6 RV7
SRV     RV5 RV2 RE12
NOP
NOP
SRV     RV5 RV5 RE12
NOP
NOP
SUMVV   RV3 RV6 RV5
NOP
NOP
SAL end_alpha_composition


end_alpha_composition
SAL hor_continue_iterate_rows

end_horizontal
NOP