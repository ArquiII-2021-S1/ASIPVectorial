SUMEI   RE2 RE0 2      # Alpha value


SUMEI   RE9 RE0 0       # k start value
SUMEI   RE7 RE0 200     # Loop limit    



iterate_channels
SUMEI   RE15 RE0 4      # k max value
SUMEI   RE10 RE0 0      # j start value
SUMEI   RE13 RE0 0      # red channel 
SEQ RE9 RE15 end_process
SUMEI   RE14 RE0 1      # green channel
SUMEI   RE15 RE0 2      # blue channel
NOP

SEQ RE9 RE13 process_red
SEQ RE9 RE14 end_process
SEQ RE9 RE15 end_process




process_red
SUMEI   RE5 RE0 1200    # Red channel start address
SUMEI   RE1 RE0 1
SUMEI   RE15 RE0 17
NOP
NOP
SLE     RE1 RE1 RE15
NOP
NOP
SUMEI   RE1 RE1 28      # Result store start address

SUMEI   RE15 RE0 4079   # Building red channel intensity address
SUMEI   RE14 RE0 6
NOP
NOP
SLE     RE15 RE15 RE14
SUMEI   RE14 RE0 44
NOP  
NOP  
SUMEE   RE15 RE15 RE14  # red channel intensity address
NOP
NOP
CRGE    RE15 RE15       # load red channel intensity
NOP
NOP


SUMEI   RE12 RE0 4079   # Building filter address
SUMEI   RE14 RE0 6
NOP
NOP
SLE     RE12 RE12 RE14
SUMEI   RE14 RE0 48
NOP  
NOP  
SUMEE   RE12 RE12 RE14  # Filter address
NOP
NOP

CRGE    RE12 RE12       # Load filter type 
SUMEI   RE14 RE0 3      # Custom mask value
NOP
NOP
SEQ     RE12 RE14 load_custom_degraded_mask
NOP
NOP
SAL     load_normal_degraded_mask


load_custom_degraded_mask
SUMEI   RE14 RE0 0      # 0% intensity
NOP
NOP
SEQ     RE15 RE14       zero_degraded

SUMEI   RE14 RE0 1      # 25% intensity
NOP
NOP
SEQ     RE15 RE14 custom_degraded_25

SUMEI   RE14 RE0 2      # 75% intensity
NOP
NOP
SEQ     RE15 RE14 custom_degraded_75

NOP     # 100% intensity
SAL     RE15 RE14 custom_degraded_100


custom_degraded_25
SUMEI   RE3 RE0 600     # 25% intensity
SAL hor_iterate_colums

custom_degraded_75
SUMEI   RE3 RE0 800     # 75% intensity
SAL hor_iterate_colums

custom_degraded_100
SUMEI   RE3 RE0 1000    # 100% intensity
SAL hor_iterate_colums





load_normal_degraded_mask
SUMEI   RE14 RE0 0      # 0% intensity
NOP
NOP
SEQ     RE15 RE14       zero_degraded

SUMEI   RE14 RE0 1      # 25% intensity
NOP
NOP
SEQ     RE15 RE14 normal_degraded_25

SUMEI   RE14 RE0 2      # 75% intensity
NOP
NOP
SEQ     RE15 RE14 normal_degraded_75

NOP     # 100% intensity
SAL     RE15 RE14 normal_degraded_100


zero_degraded
SUMEI   RE3 RE0 7575
SUMEI   RE14 RE0 4
NOP
NOP
SLE     RE3 RE3 RE14    # Mask start address

normal_degraded_25
SUMEI   RE3 RE0 0       # Mask start address
SAL hor_iterate_colums

normal_degraded_75
SUMEI   RE3 RE0 200     # Mask start address
SAL hor_iterate_colums

normal_degraded_100
SUMEI   RE3 RE0 400     # Mask start address
SAL hor_iterate_colums







hor_iterate_colums
SEQ     RE10 RE7 hor_end_iterate_colums
SUMEI   RE11 RE0 0      # i start value
SUMEE   RE15 RE3 RE10   # RE15 = mask_start_address + j
SUMEE   RE6 RE1 RE10    # store_address = store_start_address + j
SUMEE   RE8 RE5 RE10    # row_start_address = row_start_address + j
CRGV    RV1 RE15        # Load mask section


hor_iterate_rows
SEQ     RE11 RE7 hor_end_iterate_rows      
CRGV    RV2 RE8         # Load row section

SAL  alpha_composition

hor_continue_iterate_rows
SUMEI   RE11 RE11 1     # Increment i counter by 1
SUMEI   RE8 RE8 200     # Increment address by 200 to read the next row
ALMV    RE6 RV3         # Store result section
SUMEI   RE6 RE6 200     # Increment store counter by 200

SAL hor_iterate_rows

hor_end_iterate_rows
SUMEI   RE10 RE10 20    # j = j + 20
NOP
NOP
SAL     hor_iterate_colums


hor_end_iterate_colums
SUMEI   RE9 RE9 1       # k = k + 1
NOP
NOP
SAL  iterate_channels




SUMEI   RE4 RE0 187
SUMEV   RV1 RV0 RE4
SUMEI   RE4 RE0 75
SUMEV   RV2 RV0 RE4



alpha_composition
SUMEI   RE12 RE0 1
SUMEI   RE13 RE0 0
SUMEI   RE14 RE0 1
SUMEI   RE15 RE0 2

SEQ     RE2 RE13 alpha_zero
SEQ     RE2 RE14 alpha_one
SEQ     RE2 RE15 alpha_two
SAL     alpha_three

alpha_zero
SUMVV   RV3 RV0 RV2
NOP
NOP
SAL     end_alpha_composition

alpha_three
SUMVV   RV3 RV0 RV1
NOP
NOP
SAL     end_alpha_composition

alpha_one
SRV     RV4 RV1 RE12
NOP
NOP
SRV     RV4 RV4 RE12
SRV     RV7 RV2 RE12
NOP
NOP
SRV     RV6 RV7 RE12
NOP
NOP
SUMVV   RV3 RV6 RV7
NOP
NOP
SUMVV   RV3 RV4 RV3
NOP
NOP
SAL     end_alpha_composition  

alpha_two
SRV     RV7 RV1 RE12
NOP
NOP
SRV     RV6 RV7 RE12
NOP
NOP
SUMVV   RV6 RV6 RV7
SRV     RV5 RV2 RE12
NOP
NOP
SRV     RV5 RV5 RE12
NOP
NOP
SUMVV   RV3 RV6 RV5
NOP
NOP
SAL end_alpha_composition


end_alpha_composition
SAL hor_continue_iterate_rows

end_horizontal
end_process
NOP